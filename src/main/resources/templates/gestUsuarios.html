<!DOCTYPE html>
<html class="h-100" xmlns:th="http://www.thymeleaf.org">

<head>
    <link href="https://fonts.googleapis.com/css2?family=Uncial+Antiqua&display=swap" rel="stylesheet">
    <th:block th:replace="~{fragments/head :: header}" />
    <title>Gestionar Usuarios</title>
</head>

<body>
    <header th:replace="~{fragments/nav.html :: nav}"></header>
    <h1 class="adminTitle text-center">Gestión de Usuarios</h1><br>
    <div class="containerAdmin">
        <div class="sectionBuscarUsuarios">
            <h2>Usuarios</h2>
            <li th:each="usuario : ${usuarios}">
              <strong th:text="${usuario.username}"></strong> - 
              <span th:text="${usuario.firstName}"></span> 
              <span th:text="${usuario.lastName}"></span> - 
              <em th:text="${usuario.roles}"></em>
          </li>
        </div>
        <hr class="divider">
        <div class="sectionFiltrarUsuarios">
            <h2>Filtrar Usuarios</h2>
            <div class="filtrosUsuarios">
                <div class="dropdown">
                    <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                      Filtrar Baneados
                    </button>
                    <ul class="dropdown-menu">
                      <li><a class="dropdown-item" href="#" onclick="filtrarUsuarios('enCurso')">No Baneados</a></li>
                      <li><a class="dropdown-item" href="#" onclick="filtrarUsuarios('terminadas')">Baneados</a></li>
                    </ul>
                </div>
                <div class="dropdown">
                    <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                      Filtrar Admins
                    </button>
                    <ul class="dropdown-menu">
                      <li><a class="dropdown-item" href="#" onclick="filtrarUsuarios('enCurso')">Usuarios</a></li>
                      <li><a class="dropdown-item" href="#" onclick="filtrarUsuarios('terminadas')">Admins</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="degradado"></div>
    <th:block th:replace="~{fragments/footer.html :: footer}" />
</body>

<script>
  function filtrarUsuarios() {
      // Obtén los valores de los filtros
      const role = document.getElementById("filtroRole").value;
      const baneado = document.getElementById("filtroBaneado").value;

      // Construye la URL con los parámetros de filtrado
      const url = `/admin/gestUsuarios/filtrar?role=${role}&baneado=${baneado}`;

      // Realiza la solicitud al backend
      fetch(url)
          .then(response => response.json())
          .then(data => {
              // Actualiza la tabla de usuarios
              const usuariosContainer = document.getElementById("usuariosContainer");
              usuariosContainer.innerHTML = ""; // Limpia la tabla

              data.forEach(usuario => {
                  const row = `
                      <tr>
                          <td>${usuario.id}</td>
                          <td>${usuario.nombre}</td>
                          <td>${usuario.email}</td>
                          <td>${usuario.role}</td>
                          <td>${usuario.baneado ? "Sí" : "No"}</td>
                      </tr>
                  `;
                  usuariosContainer.innerHTML += row;
              });
          })
          .catch(error => console.error("Error al filtrar usuarios:", error));
  }
</script>

</html>