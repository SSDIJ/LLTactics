<!DOCTYPE html>
<html class="h-100" xmlns:th="http://www.thymeleaf.org">
<head>
    <link href="https://fonts.googleapis.com/css2?family=Uncial+Antiqua&display=swap" rel="stylesheet">
    <th:block th:replace="~{fragments/head :: header}" />
    <title>LL Tactics</title>
    <link rel="stylesheet" href="styles.css"> <!-- Enlazamos el archivo CSS -->
</head>
<body class="profile-body">
    <header th:replace="~{fragments/nav.html :: nav}"></header>
    
    <img src="/img/homepage/sword.png" alt="Espada" id="homepage-sword">

       <!-- TOP: BARRA DE BUSQUEDA DE JUGADOR Y ENVIAR MENSAJES -->
       <div class="top-user">
        <div class="busqueda">
    <form action="/user/viewProfile" method="GET">
        <input type="text" id="searchPlayer" name="nombre" placeholder="Buscar jugador..."/>
        <button type="submit" id="searchBtn" class="btn btn-primary">Buscar</button>
    </form>
</div>

        </div>
        <form th:action="@{/user/__${user.id}__/msg}" method="POST">
            <input type="text" id="message" placeholder="escribe a este usuario" />
            <button id="sendmsg" class="btn btn-secondary" type="submit">Enviar</button>
        </form>
    </div>

<!-- IMAGEN DE PERFIL -->
<div class="mid-user">
    <h1 class="mt-5">Perfil de <span th:text="${user.username}"></span></h1>
    <div class="profile-pic">
        <!-- Si la foto de perfil es null, mostramos la imagen por defecto -->
        <div th:if="${user.fotoPerfil == null}">
            <img th:src="@{/img/profile_pics/default_profile.png}" alt="Foto de perfil"/>
        </div>
        <!-- Si hay una foto de perfil, la mostramos -->
        <div th:unless="${user.fotoPerfil == null}">
            <img th:src="@{/img/profile_pics/{filename}(filename=${user.fotoPerfil})}" alt="Foto de perfil"/>
        </div>
    </div>
    <!-- Selector para cambiar la foto de perfil -->
    <form th:action="@{/user/updateFoto}" method="post">
        <label for="selectedPic">Selecciona una foto:</label>
        <select name="selectedPic" id="selectedPic">
            <!-- Aquí se insertarán las imágenes disponibles en la carpeta profile/pics -->
            <option th:each="pic : ${availablePics}" th:value="${pic}" th:text="${pic}"></option>
        </select>
        <button type="submit">Actualizar Foto</button>
    </form>
</div>
</div>
 

    <!-- RECEPCIÓN DE MENSAJES -->
    <div class="py-5 row" id="mensajes">
    </div>


    <!-- ESTADÍSTICAS DEL PERFIL -->
    <div class="bot-user">
        <div class="stat-item">
            <p>Puntuación de maestría</p>
            <h3 th:text="${user.puntuacion}">410</h3>  
        </div>
        <div class="stat-item">
            <p>Personaje más jugado</p>
            <img src="/img/units/humans/3. Caballero/knight.png" alt="Caballero"/> <!-- ESTÁTICO DE MOMENTO -->
            <!--<img th:src="@{/img/units/{unitCategory}/{unitName}/{unitName}.png(unitCategory=${user.mostPlayedCharacter.category}, unitName=${user.mostPlayedCharacter.name})}" alt="Personaje más jugado"/>  Personaje más jugado dinámico -->
        </div>
        <div class="stat-item">
            <p>Facción favorita</p>
        <!--0 = humanos, 1 = dragones, 2 = trolls, 3 = no muertos, 4 = criaturas legendarias-->
        
           <img th:if="${user.faccionFavorita==0}" src="/img/units/banners/humans.png">
           <img th:if="${user.faccionFavorita==1}" src="/img/units/banners/dragons.png">
           <img th:if="${user.faccionFavorita==2}" src="/img/units/banners/trolls.png">
           <img th:if="${user.faccionFavorita==3}" src="/img/units/banners/undead.png">
           <img th:if="${user.faccionFavorita==4}" src="/img/units/banners/legendaries.png">
           <img th:if="${user.faccionFavorita>4}" src="/img/units/banners/humans.png">
        
        </div>
        <div class="stat-item chart-container">
            <canvas id="winrateChart"></canvas>
        </div>
    </div>

    <th:block th:replace="~{fragments/footer.html :: footer}" />

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        var partidasGanadas = [[${user.partidasGanadas}]];
        var partidasPerdidas = [[${user.partidasPerdidas}]];
    
        var ctx1 = document.getElementById('winrateChart').getContext('2d');
        new Chart(ctx1, {
            type: 'doughnut',
            data: {
                labels: ['Victorias', 'Derrotas'],
                datasets: [{
                    data: [partidasGanadas, partidasPerdidas],
                    backgroundColor: ['#4CAF50', '#F44336']
                }]
            },
            options: {
                plugins: {
                    legend: {
                        labels: {
                            color: 'white'
                        }
                    }
                }
            }
        });
    </script>

    
</body>
</html>
