<!DOCTYPE html>
<html class="h-100" xmlns:th="http://www.thymeleaf.org">
<head>
    <link href="https://fonts.googleapis.com/css2?family=Uncial+Antiqua&display=swap" rel="stylesheet">
    
    <title>LL Tactics</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Uncial+Antiqua&display=swap" rel="stylesheet">
    
    <th:block th:replace="~{fragments/head :: header}" />
</head>
<body class="profile-body">
    <header th:replace="~{fragments/nav.html :: nav}"></header>

    <img src="/img/homepage/sword.png" alt="Espada" id="homepage-sword">

    <!-- BARRA DE MENSAJE -->
    <div class="user">
        <div class="top-user">
            <form th:action="@{/user/__${usuarioBuscado.id}__/msg}" method="POST">
                <div class="input-group" style="max-width: 300px;">
                    <span class="input-group-text bg-white border-end-0">
                        <button type="submit" class="btn btn-light border-0" id="sendmsg">
                            <i class="fas fa-paper-plane text-muted"></i>
                        </button>
                    </span>
                    <input type="text" id="message" name="message" class="form-control border-start-0 border-end-0" placeholder="Escribe a este usuario" />
                </div>
            </form>
        </div>
    </div>

    <!-- NOMBRE DE USUARIO -->
    <div class="mid-user text-center">
        <h1 class="mt-5 text-center"><span th:text="${usuarioBuscado.username}"></span></h1>


        <div class="profile-pic">
            <div th:if="${usuarioBuscado.fotoPerfil == null}">
                <img th:src="@{/img/profile_pics/default_profile.png}" alt="Foto de perfil" class="rounded-circle border border-3 border-dark shadow" />
            </div>
            <div th:unless="${usuarioBuscado.fotoPerfil == null}">
                <img th:src="${usuarioBuscado.fotoPerfil}" alt="Foto de perfil" class="rounded-circle border border-3 border-dark shadow" />
            </div>
        </div>
    </div>


    <!-- ESTADÍSTICAS -->
    <div class="bot-user">
        <div class="container mt-5">
            <div class="row d-flex justify-content-between" style="flex-wrap: wrap;">
                <!-- PUNTUACIÓN -->
                <div class="card text-center p-3 mb-3" style="flex: 1 1 22%; min-width: 100px;">
                    <div class="card-body">
                        <h5 class="card-title">Puntuación de Maestría</h5>
                        <h3 class="text-primary" th:text="${usuarioBuscado.puntuacion}">410</h3>
                    </div>
                </div>

                <!-- PERSONAJE MÁS JUGADO -->
                <div class="card text-center p-3 mb-3" style="flex: 1 1 22%; min-width: 100px;">
                    <div class="card-body">
                        <h5 class="card-title">Personaje más Jugado</h5>
                        <div th:if="${usuarioBuscado.masJugados != null and !usuarioBuscado.masJugados.isEmpty()}">
                            <img th:src="@{/img/units/{unitCategory}/{unitName}/{unitName}.png(unitCategory=${usuarioBuscado.masJugados[0].category}, unitName=${usuarioBuscado.masJugados[0].name})}" class="img-fluid rounded-circle" />
                        </div>
                        <p th:unless="${usuarioBuscado.masJugados != null and !usuarioBuscado.masJugados.isEmpty()}">
                            No hay datos aún
                        </p>
                    </div>
                </div>

                <!-- FACCION FAVORITA -->
                <div class="card text-center p-3 mb-3" style="flex: 1 1 22%; min-width: 100px;">
                    <div class="card-body">
                        <h5 class="card-title">Facción Favorita</h5>
                        <img th:if="${usuarioBuscado.faccionFavorita == 0}" src="/img/units/banners/humans.png" class="img-fluid" alt="Humanos">
                        <img th:if="${usuarioBuscado.faccionFavorita == 1}" src="/img/units/banners/dragons.png" class="img-fluid" alt="Dragones">
                        <img th:if="${usuarioBuscado.faccionFavorita == 2}" src="/img/units/banners/trolls.png" class="img-fluid" alt="Trolls">
                        <img th:if="${usuarioBuscado.faccionFavorita == 3}" src="/img/units/banners/undead.png" class="img-fluid" alt="No Muertos">
                        <img th:if="${usuarioBuscado.faccionFavorita == 4}" src="/img/units/banners/legendaries.png" class="img-fluid" alt="Legendarios">
                        <img th:if="${usuarioBuscado.faccionFavorita > 4}" src="/img/units/banners/humans.png" class="img-fluid" alt="Humanos">
                    </div>
                </div>

                <!-- VICTORIAS Y DERROTAS -->
                <div class="card text-center p-3 mb-3" style="flex: 1 1 22%; min-width: 100px;">
                    <div class="card-body">
                        <h5 class="card-title">Ratio de Victorias</h5>
                        <div th:if="${usuarioBuscado.partidasGanadas == 0 and usuarioBuscado.partidasPerdidas == 0}">
                            <p>No hay datos aún</p>
                        </div>
                        <div th:unless="${usuarioBuscado.partidasGanadas == 0 and usuarioBuscado.partidasPerdidas == 0}">
                            <canvas id="winrateChart" width="200" height="200"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        var partidasGanadas = [[${usuarioBuscado.partidasGanadas}]];
        var partidasPerdidas = [[${usuarioBuscado.partidasPerdidas}]];

        const canvas = document.getElementById("winrateChart");

        if (canvas) {
            const ctx = canvas.getContext("2d");

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Victorias', 'Derrotas'],
                    datasets: [{
                        data: [partidasGanadas, partidasPerdidas],
                        backgroundColor: ['#4CAF50', '#F44336']
                    }]
                },
                options: {
                    plugins: {
                        legend: {
                            labels: {
                                color: 'white'
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
